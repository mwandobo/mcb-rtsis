-- Income Statement Report for BOT API (DB2 Optimized - Single Query)
-- Returns data ready for JSON transformation with key-value pairs

SELECT 
    -- Reporting Date in DDMMYYYYHHMM format
    TO_CHAR(CURRENT_TIMESTAMP, 'DDMMYYYYHH24MI') as reportingDate,
    
    -- D46: Interest Income (individual item codes and total)
    SUM(CASE WHEN gl.EXTERNAL_GLACCOUNT IN ('400010001','400010005','400020001','400020012','400030001','400030002','400030003','400030005','400040001','400040002','400040003','400040006','400030007','400030009') 
        THEN COALESCE(gte.DC_AMOUNT, 0) ELSE 0 END) as interestIncome_1,
    SUM(CASE WHEN gl.EXTERNAL_GLACCOUNT IN ('408010001') 
        THEN COALESCE(gte.DC_AMOUNT, 0) ELSE 0 END) as interestIncome_2,
    SUM(CASE WHEN gl.EXTERNAL_GLACCOUNT IN ('404020001') 
        THEN COALESCE(gte.DC_AMOUNT, 0) ELSE 0 END) as interestIncome_3,
    SUM(CASE WHEN gl.EXTERNAL_GLACCOUNT IN ('400060001','400060002','400060005','400060004','400061001','400070003') 
        THEN COALESCE(gte.DC_AMOUNT, 0) ELSE 0 END) as interestIncome_6,
    SUM(CASE WHEN gl.EXTERNAL_GLACCOUNT LIKE '401%' OR gl.EXTERNAL_GLACCOUNT LIKE '402%' OR gl.EXTERNAL_GLACCOUNT LIKE '403%' 
        THEN COALESCE(gte.DC_AMOUNT, 0) ELSE 0 END) as interestIncome_11,
    -- Total Interest Income
    SUM(CASE WHEN gl.EXTERNAL_GLACCOUNT IN ('400010001','400010005','400020001','400020012','400030001','400030002','400030003','400030005','400040001','400040002','400040003','400040006','400030007','400030009','408010001','404020001','400060001','400060002','400060005','400060004','400061001','400070003')
        OR gl.EXTERNAL_GLACCOUNT LIKE '401%' OR gl.EXTERNAL_GLACCOUNT LIKE '402%' OR gl.EXTERNAL_GLACCOUNT LIKE '403%'
        THEN COALESCE(gte.DC_AMOUNT, 0) ELSE 0 END) as interestIncomeValue,
    
    -- D47: Interest Expenses (individual item codes and total)
    SUM(CASE WHEN gl.EXTERNAL_GLACCOUNT IN ('600220001','600220002','600220003','600220004','600220005','600220006','600220009','600220010') 
        THEN COALESCE(gte.DC_AMOUNT, 0) ELSE 0 END) as interestExpenses_1,
    SUM(CASE WHEN gl.EXTERNAL_GLACCOUNT IN ('602010001') 
        THEN COALESCE(gte.DC_AMOUNT, 0) ELSE 0 END) as interestExpenses_5,
    SUM(CASE WHEN gl.EXTERNAL_GLACCOUNT IN ('600230001','600230002','600230003','600230004','600230005','600230006','600240001','601060001') 
        THEN COALESCE(gte.DC_AMOUNT, 0) ELSE 0 END) as interestExpenses_11,
    -- Total Interest Expenses
    SUM(CASE WHEN gl.EXTERNAL_GLACCOUNT IN ('600220001','600220002','600220003','600220004','600220005','600220006','600220009','600220010','602010001','600230001','600230002','600230003','600230004','600230005','600230006','600240001','601060001')
        THEN COALESCE(gte.DC_AMOUNT, 0) ELSE 0 END) as interestExpensesValue,
    
    -- D48: Non-Interest Income (individual item codes and total)
    SUM(CASE WHEN gl.EXTERNAL_GLACCOUNT IN ('505040001','505040002','505040006','505040009') 
        THEN COALESCE(gte.DC_AMOUNT, 0) ELSE 0 END) as nonInterestIncome_1,
    SUM(CASE WHEN gl.EXTERNAL_GLACCOUNT IN ('500020055','500020056','500020058') 
        THEN COALESCE(gte.DC_AMOUNT, 0) ELSE 0 END) as nonInterestIncome_4,
    SUM(CASE WHEN gl.EXTERNAL_GLACCOUNT IN ('500010009','500010010','500010015','500020001','500020003','500020010','500020011','500020014','500020015','500020016','500020018','500020019','500020020','500020027','500020030','500020036','500020038','500020062','500020065','500020070','502010001','503010001','503010011','503010012','504040001','504040002','504050001','504060001','504080001','504100001','504110001','504120002','504130001') 
        THEN COALESCE(gte.DC_AMOUNT, 0) ELSE 0 END) as nonInterestIncome_5,
    SUM(CASE WHEN gl.EXTERNAL_GLACCOUNT IN ('505010001') 
        THEN COALESCE(gte.DC_AMOUNT, 0) ELSE 0 END) as nonInterestIncome_15,
    SUM(CASE WHEN gl.EXTERNAL_GLACCOUNT IN ('500020017','505000000','505070001') 
        THEN COALESCE(gte.DC_AMOUNT, 0) ELSE 0 END) as nonInterestIncome_20,
    -- Total Non-Interest Income
    SUM(CASE WHEN gl.EXTERNAL_GLACCOUNT IN ('505040001','505040002','505040006','505040009','500020055','500020056','500020058','500010009','500010010','500010015','500020001','500020003','500020010','500020011','500020014','500020015','500020016','500020018','500020019','500020020','500020027','500020030','500020036','500020038','500020062','500020065','500020070','502010001','503010001','503010011','503010012','504040001','504040002','504050001','504060001','504080001','504100001','504110001','504120002','504130001','505010001','500020017','505000000','505070001')
        THEN COALESCE(gte.DC_AMOUNT, 0) ELSE 0 END) as nonInterestIncomeValue,
    
    -- D49: Non-Interest Expenses (individual item codes and total)
    SUM(CASE WHEN gl.EXTERNAL_GLACCOUNT IN ('700010001','700010004','700010005','700020002','700030001','700040002','700050001','700060001','700090001','700090005','700090009','700090006','700090011','700090013','700090015','701020001','701020005','701020006') 
        THEN COALESCE(gte.DC_AMOUNT, 0) ELSE 0 END) as nonInterestExpenses_1,
    SUM(CASE WHEN gl.EXTERNAL_GLACCOUNT IN ('701010001') 
        THEN COALESCE(gte.DC_AMOUNT, 0) ELSE 0 END) as nonInterestExpenses_5,
    SUM(CASE WHEN gl.EXTERNAL_GLACCOUNT IN ('703020001') 
        THEN COALESCE(gte.DC_AMOUNT, 0) ELSE 0 END) as nonInterestExpenses_7,
    SUM(CASE WHEN gl.EXTERNAL_GLACCOUNT IN ('703020004','703020006','703020008','703020011') 
        THEN COALESCE(gte.DC_AMOUNT, 0) ELSE 0 END) as nonInterestExpenses_8,
    SUM(CASE WHEN gl.EXTERNAL_GLACCOUNT IN ('701010009') 
        THEN COALESCE(gte.DC_AMOUNT, 0) ELSE 0 END) as nonInterestExpenses_9,
    SUM(CASE WHEN gl.EXTERNAL_GLACCOUNT IN ('705020001') 
        THEN COALESCE(gte.DC_AMOUNT, 0) ELSE 0 END) as nonInterestExpenses_12,
    SUM(CASE WHEN gl.EXTERNAL_GLACCOUNT IN ('705070001','705100004','705080002','705110003','705100003','705110002','705110004','705110005','705110006','705110007') 
        THEN COALESCE(gte.DC_AMOUNT, 0) ELSE 0 END) as nonInterestExpenses_13,
    SUM(CASE WHEN gl.EXTERNAL_GLACCOUNT IN ('705080002') 
        THEN COALESCE(gte.DC_AMOUNT, 0) ELSE 0 END) as nonInterestExpenses_23,
    SUM(CASE WHEN gl.EXTERNAL_GLACCOUNT IN ('705040001','705040009','705040011') 
        THEN COALESCE(gte.DC_AMOUNT, 0) ELSE 0 END) as nonInterestExpenses_24,
    SUM(CASE WHEN gl.EXTERNAL_GLACCOUNT IN ('700090003','700090004','701010002','701010003','701010006','701010008','701010012','701010013','701010010','702010002','702030001','702030003','702030004','702040002','702040004','702040006') 
        THEN COALESCE(gte.DC_AMOUNT, 0) ELSE 0 END) as nonInterestExpenses_25,
    SUM(CASE WHEN gl.EXTERNAL_GLACCOUNT IN ('704010001','704020001','704020002','704020004','704020007','704020012','704020013','704030004') 
        THEN COALESCE(gte.DC_AMOUNT, 0) ELSE 0 END) as nonInterestExpenses_33,
    SUM(CASE WHEN gl.EXTERNAL_GLACCOUNT IN ('705190001','705190002','705190003') 
        THEN COALESCE(gte.DC_AMOUNT, 0) ELSE 0 END) as nonInterestExpenses_34,
    SUM(CASE WHEN gl.EXTERNAL_GLACCOUNT IN ('705050001','705060002','705060004','705090001') 
        THEN COALESCE(gte.DC_AMOUNT, 0) ELSE 0 END) as nonInterestExpenses_36,
    SUM(CASE WHEN gl.EXTERNAL_GLACCOUNT IN ('705010001','705010002','705010003') 
        THEN COALESCE(gte.DC_AMOUNT, 0) ELSE 0 END) as nonInterestExpenses_37,
    SUM(CASE WHEN gl.EXTERNAL_GLACCOUNT IN ('705120001','705120005','705120006') 
        THEN COALESCE(gte.DC_AMOUNT, 0) ELSE 0 END) as nonInterestExpenses_39,
    SUM(CASE WHEN gl.EXTERNAL_GLACCOUNT IN ('705160001','705160002','705160003','705170001','702040006') 
        THEN COALESCE(gte.DC_AMOUNT, 0) ELSE 0 END) as nonInterestExpenses_40,
    -- Total Non-Interest Expenses
    SUM(CASE WHEN gl.EXTERNAL_GLACCOUNT IN ('700010001','700010004','700010005','700020002','700030001','700040002','700050001','700060001','700090001','700090005','700090009','700090006','700090011','700090013','700090015','701020001','701020005','701020006','701010001','703020001','703020004','703020006','703020008','703020011','701010009','705020001','705070001','705100004','705080002','705110003','705100003','705110002','705110004','705110005','705110006','705110007','705040001','705040009','705040011','700090003','700090004','701010002','701010003','701010006','701010008','701010012','701010013','701010010','702010002','702030001','702030003','702030004','702040002','702040004','702040006','704010001','704020001','704020002','704020004','704020007','704020012','704020013','704030004','705190001','705190002','705190003','705050001','705060002','705060004','705090001','705010001','705010002','705010003','705120001','705120005','705120006','705160001','705160002','705160003','705170001')
        THEN COALESCE(gte.DC_AMOUNT, 0) ELSE 0 END) as nonInterestExpensesValue,
    
    -- D50: Non-Core Credits and Charges (individual item codes and total)
    SUM(CASE WHEN gl.EXTERNAL_GLACCOUNT IN ('505070001') 
        THEN COALESCE(gte.DC_AMOUNT, 0) ELSE 0 END) as nonCoreCreditsCharges_1,
    SUM(CASE WHEN gl.EXTERNAL_GLACCOUNT IN ('505010001') 
        THEN COALESCE(gte.DC_AMOUNT, 0) ELSE 0 END) as nonCoreCreditsCharges_3,
    -- Total Non-Core Credits and Charges
    SUM(CASE WHEN gl.EXTERNAL_GLACCOUNT IN ('505070001','505010001')
        THEN COALESCE(gte.DC_AMOUNT, 0) ELSE 0 END) as nonCoreCreditsChargesValue,
    
    -- Single value fields
    0 as badDebtsWrittenOffNotProvided,
    SUM(CASE WHEN gl.EXTERNAL_GLACCOUNT IN ('705190002') 
        THEN COALESCE(gte.DC_AMOUNT, 0) ELSE 0 END) as provisionBadDoubtfulDebts,
    0 as impairmentsInvestments,
    0 as incomeTaxProvision,
    0 as extraordinaryCreditsCharge

FROM GLI_TRX_EXTRACT gte
INNER JOIN GLG_ACCOUNT gl ON gl.ACCOUNT_ID = gte.FK_GLG_ACCOUNTACCO

WHERE gl.EXTERNAL_GLACCOUNT IN (
    -- Interest Income accounts
    '400010001','400010005','400020001','400020012','400030001','400030002','400030003','400030005',
    '400040001','400040002','400040003','400040006','400060001','400060002','400060004','400060005',
    '400061001','400070003','401010001','401010003','401010005','401020001','401020012','401030001',
    '401030002','401030005','401040002','401040003','401040004','401040006','402030002','402030003',
    '402030005','402040001','402040002','403030005','403040002','404020001','408010001','400030007',
    '400030009',
    -- Interest Expense accounts
    '600220001','600220002','600220003','600220004','600220005','600220006','600220009','600220010',
    '600230001','600230002','600230003','600230004','600230005','600230006','600240001','601060001',
    '602010001',
    -- Non-Interest Income accounts
    '500010009','500010010','500010015','500020001','500020003','500020010','500020011','500020014',
    '500020015','500020016','500020017','500020018','500020019','500020020','500020027','500020030',
    '500020036','500020038','500020055','500020056','500020058','500020062','500020065','500020070',
    '502010001','503010001','503010011','503010012','504040001','504040002','504050001','504060001',
    '504080001','504100001','504110001','504120002','504130001','505000000','505010001','505040001',
    '505040002','505040006','505040009','505070001',
    -- Non-Interest Expense accounts
    '700010001','700010004','700010005','700010017','700020002','700030001','700040002','700050001',
    '700060001','700090001','700090003','700090004','700090005','700090006','700090009','700090011',
    '700090013','700090015','701010001','701010002','701010003','701010006','701010008','701010009',
    '701010010','701010011','701010012','701010013','701020001','701020005','701020006','702010002',
    '702030001','702030003','702030004','702040002','702040004','702040006','703020001','703020004',
    '703020006','703020008','703020011','704010001','704020001','704020002','704020004','704020007',
    '704020012','704020013','704030004','705010001','705010002','705010003','705020001','705040001',
    '705040005','705040009','705040011','705050001','705060002','705060004','705070001','705080002',
    '705090001','705100003','705100004','705110002','705110003','705110004','705110005','705110006',
    '705110007','705120001','705120005','705120006','705160001','705160002','705160003','705170001',
    '705190001','705190002','705190003'
);
