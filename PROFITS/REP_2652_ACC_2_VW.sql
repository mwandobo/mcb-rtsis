CREATE VIEW REP_2652_ACC_2_VW  (     CUST_ID,     ACCOUNT_NUMBER,     TRX_DATE,     ID_JUSTIFIC,     AMOUNT,     CURRENCY_ID,     DEBIT_CREDIT_FLAG  )  AS     WITH dep          AS (SELECT deposit_account.*                FROM deposit_account               WHERE     NOT EXISTS                                (SELECT 'x'                                   FROM generic_detail prop                                  WHERE     prop.fk_generic_headpar = 'PRORC'                                        AND fk_depositfk_produ =                                               prop.serial_num)                     AND deposit_account.entry_status <> '0'),          hist          AS (  SELECT fk_customercust_id cust_id,                       dep.account_number,                       trx_date,                       id_justific,                       fk_currencyid_curr currency_id,                       debit_credit_flag,                       SUM (entry_amount) amount                  FROM history_fd_extrait, dep                 WHERE     EXISTS                              (SELECT 'x'                                 FROM generic_detail just                                WHERE     just.fk_generic_headpar = 'JUSRC'                                      AND just.serial_num = id_justific)                       AND history_fd_extrait.not_printed_flag < '1'                       AND dep.account_number = history_fd_extrait.account_number              GROUP BY fk_customercust_id,                       dep.account_number,                       trx_date,                       id_justific,                       fk_currencyid_curr,                       debit_credit_flag),          td          AS (  SELECT dep.fk_customercust_id,                       dep.account_number,                       trx_date,                       id_justific,                       fk_currencyid_curr currency_id,                       debit_credit_flag,                       SUM (entry_amount) amount                  FROM time_depos_extrait, dep                 WHERE     EXISTS                              (SELECT 'x'                                 FROM generic_detail just                                WHERE     just.fk_generic_headpar = 'JUSRC'                                      AND id_justific = just.serial_num)                       AND time_depos_extrait.not_printed_flg < '1'                       AND dep.account_number =                              time_depos_extrait.fk_deposit_accoacc              GROUP BY dep.fk_customercust_id,                       dep.account_number,                       trx_date,                       id_justific,                       fk_currencyid_curr,                       debit_credit_flag)     SELECT "CUST_ID",            "ACCOUNT_NUMBER",            "TRX_DATE",            "ID_JUSTIFIC",            "AMOUNT",            currency_id,            debit_credit_flag       FROM hist     UNION ALL     SELECT "FK_CUSTOMERCUST_ID",            "ACCOUNT_NUMBER",            "TRX_DATE",            "ID_JUSTIFIC",            "AMOUNT",            currency_id,            debit_credit_flag       FROM td;

