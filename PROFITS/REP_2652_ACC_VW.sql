CREATE VIEW REP_2652_ACC_VW  (     CUST_ID,     ACCOUNT_NUMBER,     TRX_DATE,     ID_JUSTIFIC,     AMOUNT,     CURRENCY_ID  )  AS     WITH dep          AS (SELECT deposit_account.*                FROM deposit_account               WHERE     fk_depositfk_produ NOT IN (SELECT prop.serial_num                                                      FROM generic_detail prop                                                     WHERE prop.fk_generic_headpar =                                                              'PRORP')                     AND deposit_account.entry_status <> '0'),          hist          AS (  SELECT fk_customercust_id cust_id,                       dep.account_number,                       trx_date,                       id_justific,                       fk_currencyid_curr currency_id,                       SUM (entry_amount) amount                  FROM history_fd_extrait, dep                 WHERE                    --id_justific in (31201, 31001, 31004)
                    id_justific NOT IN (SELECT just.serial_num                                            FROM generic_detail just                                           WHERE just.fk_generic_headpar =                                                    'JUSRP')                       AND history_fd_extrait.not_printed_flag < '1'                       AND dep.account_number = history_fd_extrait.account_number              GROUP BY fk_customercust_id,                       dep.account_number,                       trx_date,                       id_justific,                       fk_currencyid_curr),          td          AS (  SELECT dep.fk_customercust_id,                       dep.account_number,                       trx_date,                       id_justific,                       fk_currencyid_curr currency_id,                       SUM (entry_amount) amount                  FROM time_depos_extrait, dep                 WHERE                    --id_justific in (31201, 31001, 31004)
                    id_justific NOT IN (SELECT just.serial_num                                            FROM generic_detail just                                           WHERE just.fk_generic_headpar =                                                    'JUSRP')                       AND time_depos_extrait.not_printed_flg < '1'                       AND dep.account_number =                              time_depos_extrait.fk_deposit_accoacc              GROUP BY dep.fk_customercust_id,                       dep.account_number,                       trx_date,                       id_justific,                       fk_currencyid_curr)     SELECT "CUST_ID",            "ACCOUNT_NUMBER",            "TRX_DATE",            "ID_JUSTIFIC",            "AMOUNT",            currency_id       FROM hist     UNION ALL     SELECT "FK_CUSTOMERCUST_ID",            "ACCOUNT_NUMBER",            "TRX_DATE",            "ID_JUSTIFIC",            "AMOUNT",            currency_id       FROM td;

