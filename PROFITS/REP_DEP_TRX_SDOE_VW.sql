CREATE VIEW REP_DEP_TRX_SDOE_VW  (     SDOE_SUBSYSTEM,     CUST_ID,     ACCOUNT_NUMBER,     ACC_CURRENCY_ID,     TRX_AMOUNT,     I_COMMENTS,     TRX_DATE,     TRX_UNIT,     TRX_USR,     TRX_USR_SN,     TRX_DEBIT_SN,     TRX_CREDIT_SN,     TRX_CODE,     JUSTIFIC_ID,     ORDER_CODE,     FXRATE,     DEBIT_CREDIT_FLAG,     TMSTAMP  )  AS     WITH dct          AS (SELECT 1 sdoe_subsystem,                     pa.cust_id,                     CAST (prft_account AS CHAR (40)) account_number,                     pa.movement_currency,                     i.order_amount,                     i.comments,                     i.trx_date,                     i.trx_unit,                     ' ' trx_usr,                     0 trx_usr_sn,                     0 trx_debit_sn,                     0 trx_credit_sn,                     i.trx_code,                     i.justific_id,                     i.order_code,                     0 fxrate,                     0 AS debit_credit_flag,                     order_timestamp tmstamp                FROM ips_message_header i,                     frt_bank f,                     profits_account pa,                     customer cust2               WHERE     TRIM (i.credit_bic_address) = TRIM (f.bic_address)                     AND f.country != 'GR'                     AND i.trx_code IN (9002, 9006)                     AND TRIM (pa.account_number) = TRIM (i.prft_account)                     AND pa.prft_system = 3                     AND cust2.cust_id = pa.cust_id                     AND cust2.cust_type = '1'),          dep1          AS (SELECT 2 sdoe_subsystem,                     cust0.cust_id cust_id,                     profits_account.account_number,                     profits_account.movement_currency acc_currency_id,                       dtrx.acc_amount_49                     + dtrx.acc_amount_50                     + dtrx.acc_amount_46                     + dtrx.acc_amount_47                        trx_amount,                     dtrx.i_comments i_comments,                     trx_date,                     dtrx.trx_unit,                     trx_usr,                     dtrx.trx_usr_sn,                     0 trx_debit_sn,                     0 trx_credit_sn,                     trx_code,                     dtrx.i_id_justific justific_id,                     CAST (0 AS VARCHAR (40)) order_code,                     o_fixing_rate fxrate,                     CASE                        WHEN ABS (dtrx.acc_amount_49 + dtrx.acc_amount_50) > 0                        THEN                           1                        WHEN ABS (dtrx.acc_amount_46 + dtrx.acc_amount_47) > 0                        THEN                           2                     END                        debit_credit_flag,                     dtrx.tmstamp                FROM customer cust0,                     dep_trx_recording dtrx,                     profits_account,                     deposit_account               WHERE       ABS (dtrx.acc_amount_49 + dtrx.acc_amount_50)                         + ABS (dtrx.acc_amount_46 + dtrx.acc_amount_47) > 0                     AND cust0.cust_id = profits_account.cust_id                     AND profits_account.dep_acc_number =                            deposit_account.account_number                     AND profits_account.prft_system = 3                     AND dtrx.i_account_number = profits_account.dep_acc_number                     AND other_system != 9                     AND cust0.cust_type = '1'),          fxft          AS (SELECT 4 sdoe_subsystem,                     cust1.cust_id,                     prftacc.account_number,                     movement_currency acc_currency_id,                     order_amount AS trx_amount,                        TRIM (outgoing_orders.sender_to_receiver)                     || ' '                     || TRIM (outgoing_orders.special_terms)                        i_comments,                     ftrx.trx_date,                     ftrx.trx_unit,                     ftrx.trx_usr,                     ftrx.trx_sn trx_usr_sn,                     ftrx.trx_debit_sn,                     ftrx.trx_credit_sn,                     ftrx.trx_code,                     ftrx.justification justific_id,                     CAST (outgoing_orders.order_number AS VARCHAR (40))                        order_code,                     0 fxrate,                     0 AS debit_credit_flag,                     outgoing_orders.tmstamp                FROM outgoing_orders,                     profits_account prftacc,                     fx_ft_recording ftrx,                     customer cust1               WHERE     outgoing_orders.fk1customercust_id = cust1.cust_id                     AND prftacc.dep_acc_number = fk_deposit_accoacc                     AND ftrx.outgoing_order_num = outgoing_orders.order_number                     AND prftacc.prft_system = 3                     AND cust1.cust_type = '1'                     AND ftrx.trx_code = 9051),          dep2          AS (SELECT 3 sdoe_subsystem,                     cust0.cust_id cust_id,                     profits_account.account_number,                     profits_account.movement_currency acc_currency_id,                     dtrx.i_amount trx_amount,                     dtrx.i_comments i_comments,                     dtrx.trx_date,                     dtrx.trx_unit,                     dtrx.trx_usr,                     dtrx.trx_usr_sn,                     0 trx_debit_sn,                     0 trx_credit_sn,                     dtrx.trx_code,                     dtrx.i_id_justific justific_id,                     CAST (0 AS VARCHAR (40)) order_code,                     o_fixing_rate fxrate,                     CASE                        WHEN ABS (dtrx.acc_amount_49 + dtrx.acc_amount_50) > 0                        THEN                           1                        WHEN ABS (dtrx.acc_amount_46 + dtrx.acc_amount_47) > 0                        THEN                           2                     END                        debit_credit_flag,                     dtrx.tmstamp                FROM customer cust0,                     dep_trx_recording dtrx,                     profits_account,                     deposit_account               WHERE       ABS (dtrx.acc_amount_49 + dtrx.acc_amount_50)                         + ABS (dtrx.acc_amount_46 + dtrx.acc_amount_47) > 0                     AND cust0.cust_id = profits_account.cust_id                     AND profits_account.dep_acc_number =                            deposit_account.account_number                     AND profits_account.prft_system = 3                     AND dtrx.i_account_number = profits_account.dep_acc_number                     AND dtrx.other_system = 9                     AND cust0.cust_type = '1'                     AND (   (dtrx.trx_date,                              dtrx.trx_unit,                              dtrx.trx_usr,                              dtrx.trx_usr_sn) IN (SELECT trx_date,                                                          trx_unit,                                                          trx_usr,                                                          trx_debit_sn                                                     FROM fx_ft_recording f1                                                    WHERE (   trx_debit_sn <> 0                                                           OR trx_credit_sn <>                                                                 0))                          OR (dtrx.trx_date,                              dtrx.trx_unit,                              dtrx.trx_usr,                              dtrx.trx_usr_sn) IN (SELECT trx_date,                                                          trx_unit,                                                          trx_usr,                                                          trx_credit_sn                                                     FROM fx_ft_recording f1                                                    WHERE (   trx_debit_sn <> 0                                                           OR trx_credit_sn <>                                                                 0))))     SELECT "SDOE_SUBSYSTEM",            "CUST_ID",            account_number,            "MOVEMENT_CURRENCY",            "ORDER_AMOUNT",            "COMMENTS",            "TRX_DATE",            "TRX_UNIT",            "TRX_USR",            "TRX_USR_SN",            "TRX_DEBIT_SN",            "TRX_CREDIT_SN",            "TRX_CODE",            "JUSTIFIC_ID",            "ORDER_CODE",            "FXRATE",            "DEBIT_CREDIT_FLAG",            "TMSTAMP"       FROM dct     UNION ALL     SELECT "SDOE_SUBSYSTEM",            "CUST_ID",            "ACCOUNT_NUMBER",            "ACC_CURRENCY_ID",            "TRX_AMOUNT",            "I_COMMENTS",            "TRX_DATE",            "TRX_UNIT",            "TRX_USR",            "TRX_USR_SN",            "TRX_DEBIT_SN",            "TRX_CREDIT_SN",            "TRX_CODE",            "JUSTIFIC_ID",            "ORDER_CODE",            "FXRATE",            "DEBIT_CREDIT_FLAG",            "TMSTAMP"       FROM dep1     UNION ALL     SELECT "SDOE_SUBSYSTEM",            "CUST_ID",            "ACCOUNT_NUMBER",            "ACC_CURRENCY_ID",            "TRX_AMOUNT",            "I_COMMENTS",            "TRX_DATE",            "TRX_UNIT",            "TRX_USR",            "TRX_USR_SN",            "TRX_DEBIT_SN",            "TRX_CREDIT_SN",            "TRX_CODE",            "JUSTIFIC_ID",            "ORDER_CODE",            "FXRATE",            "DEBIT_CREDIT_FLAG",            "TMSTAMP"       FROM dep2     UNION ALL     SELECT "SDOE_SUBSYSTEM",            "CUST_ID",            "ACCOUNT_NUMBER",            "ACC_CURRENCY_ID",            "TRX_AMOUNT",            "I_COMMENTS",            "TRX_DATE",            "TRX_UNIT",            "TRX_USR",            "TRX_USR_SN",            "TRX_DEBIT_SN",            "TRX_CREDIT_SN",            "TRX_CODE",            "JUSTIFIC_ID",            "ORDER_CODE",            "FXRATE",            "DEBIT_CREDIT_FLAG",            "TMSTAMP"       FROM fxft;

