CREATE VIEW W_FACT_LG_TRX  AS  SELECT lg_trx_recording.trx_date          ,lg_trx_recording.trx_unit          ,lg_trx_recording.trx_usr trx_user          ,trx_usr_sn trx_sn          ,internal_sn tun_internal_sn          ,lg_trx_recording.tmstamp          ,DECODE (              NVL (i_trx_unit, 0)             ,0, ' '             ,   TO_CHAR (i_trx_date, 'yyyy-mm-dd')              || '|'              || i_trx_unit              || '|'              || TRIM (i_trx_usr)              || '|'              || i_trx_usr_sn              || '|'              || i_internal_sn)              reversed_tun          ,DECODE (NVL (i_trx_unit, 0), 1, 'Reversal', 'Original')              reversal_flag          ,DECODE (lguarantee_param.charging_limit_ind                  ,'1', lg_trx_recording.o_limit_currency                  ,lg_trx_recording.o_charge_currency)              currency_id          ,currency.short_descr currency          ,DECODE (transactions_statu, '1', 'Reversed', 'Posted')              transaction_status_flag          ,lg_trx_recording.id_justific justification_code          ,product          ,trx_code          ,acc.account_ser_num acct_key          ,acc.lg_acc_sn          ,TRIM(acc.account_number) || '-' || acc.account_cd account_no          ,  CASE                WHEN lg_trx_recording.trn_type IN ('1', '7')                THEN                   lg_trx_recording.u_user_total                ELSE                   0                 END           + CASE                WHEN lg_trx_recording.trn_type IN ('1', '7')                THEN                   lg_trx_recording.target_u_user_tota                ELSE                   0                 END              cash_debit_amt          ,  CASE                WHEN lguarantee_param.charging_limit_ind = 1                THEN                   CASE                      WHEN lg_trx_recording.trn_type IN ('2', '8')                      THEN                         lg_trx_recording.u_user_total                      ELSE                         0                       END                ELSE                   0                 END           + CASE                WHEN lg_trx_recording.trn_type IN ('2', '8')                THEN                   lg_trx_recording.target_u_user_tota                ELSE                   0                 END              cash_credit_amt          ,  CASE                WHEN lg_trx_recording.trn_type IN ('3'                                                  ,'5'                                                  ,'9'                                                  ,'A'                                                  ,'B'                                                  ,'C')                THEN                   lg_trx_recording.u_user_total                ELSE                   0                 END           + CASE                WHEN lg_trx_recording.trn_type IN ('3'                                                  ,'5'                                                  ,'9'                                                  ,'A'                                                  ,'B'                                                  ,'C')                THEN                   lg_trx_recording.target_u_user_tota                ELSE                   0                 END              journal_debit_amt          ,  CASE                WHEN lg_trx_recording.trn_type IN ('4'                                                  ,'6'                                                  ,'9'                                                  ,'A'                                                  ,'B'                                                  ,'C')                THEN                   lg_trx_recording.u_user_total                ELSE                   0                 END           + CASE                WHEN lg_trx_recording.trn_type IN ('4'                                                  ,'6'                                                  ,'9'                                                  ,'A'                                                  ,'B'                                                  ,'C')                THEN                   lg_trx_recording.target_u_user_tota                ELSE                   0                 END              journal_credit_amt          ,justific.description justification_name          ,prft_transaction.description transaction_name        FROM   lg_trx_recording           INNER JOIN lg_parameter lguarantee_param ON (1 = 1)           LEFT JOIN profits_account acc              ON (acc.lg_acc_sn = lg_trx_recording.i_account_number)           LEFT JOIN currency              ON id_currency =                    DECODE (lguarantee_param.charging_limit_ind                           ,'1', lg_trx_recording.o_limit_currency                           ,lg_trx_recording.o_charge_currency)           LEFT JOIN justific              ON justific.id_justific = lg_trx_recording.id_justific           LEFT JOIN prft_transaction              ON prft_transaction.id_transact = lg_trx_recording.trx_code        WHERE  (DECODE (lguarantee_param.charging_limit_ind                   ,'1', lg_trx_recording.o_limit_currency                   ,lg_trx_recording.o_charge_currency) <> 0)  WITH NO ROW MOVEMENT;

