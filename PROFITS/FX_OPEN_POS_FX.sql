CREATE VIEW FX_OPEN_POS_FX (
    TRX_UNIT,
TRX_DATE ,
TRX_USR ,
TRX_SN ,
TUN_INTERNAL_SN ,
TRX_CODE ,
SOURCE_CURRENCY ,
TARGET_CURRENCY ,
ACC_AMOUNT_1 ,
ACC_AMOUNT_2 ,
ACC_AMOUNT_3 ,
ACC_AMOUNT_4 ,
ACC_AMOUNT_5 ,
ACC_AMOUNT_6 ,
ACC_AMOUNT_7 ,
ACC_AMOUNT_8 ,
ACC_AMOUNT_9 ,
ACC_AMOUNT_10 ,
ACC_AMOUNT_11 ,
ACC_AMOUNT_12 ,
ACC_AMOUNT_13 ,
ACC_AMOUNT_14 ,
ACC_AMOUNT_15 ,
ACC_AMOUNT_16 ,
ACC_AMOUNT_17 ,
ACC_AMOUNT_18 ,
ACC_AMOUNT_19 ,
ACC_AMOUNT_20 ,
ACC_AMOUNT_21 ,
ACC_AMOUNT_22 ,
ACC_AMOUNT_23 ,
ACC_AMOUNT_24 ,
ACC_AMOUNT_25 ,
ACC_AMOUNT_26 ,
ACC_AMOUNT_27 ,
ACC_AMOUNT_28 ,
ACC_AMOUNT_29 ,
ACC_AMOUNT_30 ,
ACC_AMOUNT_31 ,
ACC_AMOUNT_32 ,
ACC_AMOUNT_33 ,
ACC_AMOUNT_34 ,
ACC_AMOUNT_35 ,
ACC_AMOUNT_36 ,
ACC_AMOUNT_37 ,
ACC_AMOUNT_38 ,
ACC_AMOUNT_39 ,
ACC_AMOUNT_40 ,
ACC_AMOUNT_41 ,
ACC_AMOUNT_42 ,
ACC_AMOUNT_43 ,
ACC_AMOUNT_44 ,
ACC_AMOUNT_45 ,
ACC_AMOUNT_46 ,
ACC_AMOUNT_47 ,
ACC_AMOUNT_48 ,
ACC_AMOUNT_49 ,
ACC_AMOUNT_50 ,
GL_ARTICLE_CODE ,
GL_ACCOUNT ,
GL_ACCOUNT_LEVEL ,
GL_NETWORK_ACCOUNT ,
GL_NET_ACC_LEVEL ,
ORG_TRX_UNIT ,
TRX_CUSTOMER_CODE ,
PAYMENT_DRAWN_UNIT ,
COR_GL_ACCOUNT ,
COR_GL_ACCOUNT_LVL ,
EXCH_NOTES_FLAG ,
COR_GL_ACCR_LVL ,
COR_GL_ACCR_ACC ,
ACC_AMOUNT_30_PR ,
ACC_AMOUNT_30_LS ,
ACC_AMOUNT_44_PR ,
ACC_AMOUNT_44_LS ,
ACC_AMOUNT_3_PR ,
ACC_AMOUNT_3_LS ,
ACC_AMOUNT_1_PR ,
ACC_AMOUNT_1_LS ,
TRANSACTION_STATUS ,
SOURCE_BUY_RATE ,
TARGET_SELL_RATE ,
RATE_INDICATOR ,
FX_TYPE ,
I_RATE ,
I_TRX_AMOUNT ,
I_DR_CR_FLAG ,
ACCOUNTED_FLAG ,
PRODUCT_CODE ,
JUSTIFICATION ,
SOURCE_FIXING_RATE ,
TARGET_FIXING_RATE ,
SOURCE_DEP_ACCOUNT ,
TARGET_DEP_ACCOUNT ,
SOURCE_TRN_TYPE ,
TARGET_TRN_TYPE ,
OTHER_SYSTEM ,
PRINT_ID ,
CHANNEL_ID ,
TERMINAL_CODE ,
PRODUCTION_DATE ,
PRODUCTION_TIME ,
AUTHORIZER1 ,
AUTHORIZER2 ,
ORG_TRX_DATE ,
ORG_TRX_USR ,
ORG_TRX_SN ,
CUST_NAME ,
CUST_ADDRESS1 ,
CUST_ADDRESS2 ,
CUST_ZIPCODE ,
CUST_CITY ,
CUST_TAX_REG_NUM ,
CUST_ID_PASSP_NUM ,
CUST_ID_TYPE ,
CUST_ID_ISSUE_AUTH ,
CUST_ID_ISSUE_DATE ,
CUST_COUNTRY ,
BENEF_CUST_CODE ,
BENEF_CUST_NAME ,
BENEF_CUST_ADDRES1 ,
BENEF_CUST_ADDRES2 ,
BENEF_CUST_ZIPCODE ,
BENEF_CUST_CITY ,
BENEF_CUST_ID_TYPE ,
BENEF_CUST_ID_NUM ,
BENEF_TAX_REG_NO ,
BENEF_CUST_ID_ISSU ,
BENEF_CUST_PHONE ,
RATE_TABLE_CATEG ,
SCALE_MAX_AMOUNT ,
OLD_BUY_PERCENT ,
NEW_BUY_PERCENT ,
OLD_SELL_PERCENT ,
NEW_SELL_PERCENT ,
OLD_STATUS ,
NEW_STATUS ,
COM_CHA_TAX_CURR ,
DEALER_CURRENCY_RA ,
RATE_TABLE_NUMBER ,
DEALER_CODE ,
DEALER_REF_NO ,
FX_CATEGORY ,
RESIDENT_IND ,
FX_DOC_NO ,
BALANCE_PAYM_CODE ,
DESTINATION_CNTRY ,
SOURCE_VALUE_DATE ,
TARGET_VALUE_DATE ,
AVAILABILITY_DATE ,
CORRESPONDENT ,
CORRESP_COLLECTION ,
DRAWN_BANK1 ,
CHEQUE_TYPE ,
CHEQUE_NUMBER1 ,
CHEQUE_NUMBER1_TO ,
CHEQUE_AMOUNT1 ,
CHEQUE_ISSUE_DATE1 ,
DRAWN_BANK2 ,
CHEQUE_NUMBER2 ,
CHEQUE_NUMBER2_TO ,
CHEQUE_AMOUNT2 ,
CHEQUE_ISSUE_DATE2 ,
DRAWN_BANK3 ,
CHEQUE_NUMBER3 ,
CHEQUE_NUMBER3_TO ,
CHEQUE_AMOUNT3 ,
CHEQUE_ISSUE_DATE3 ,
DRAWN_BANK4 ,
CHEQUE_NUMBER4 ,
CHEQUE_NUMBER4_TO ,
CHEQUE_AMOUNT4 ,
CHEQUE_ISSUE_DATE4 ,
DRAWN_BANK5 ,
CHEQUE_NUMBER5 ,
CHEQUE_NUMBER5_TO ,
CHEQUE_AMOUNT5 ,
CHEQUE_ISSUE_DATE5 ,
DRAWN_BANK6 ,
CHEQUE_NUMBER6 ,
CHEQUE_NUMBER6_TO ,
CHEQUE_AMOUNT6 ,
CHEQUE_ISSUE_DATE6 ,
DRAWN_BANK7 ,
CHEQUE_NUMBER7 ,
CHEQUE_NUMBER7_TO ,
CHEQUE_AMOUNT7 ,
CHEQUE_ISSUE_DATE7 ,
DRAWN_BANK8 ,
CHEQUE_NUMBER8 ,
CHEQUE_NUMBER8_TO ,
CHEQUE_AMOUNT8 ,
CHEQUE_ISSUE_DATE8 ,
DRAWN_BANK9 ,
CHEQUE_NUMBER9 ,
CHEQUE_NUMBER9_TO ,
CHEQUE_AMOUNT9 ,
CHEQUE_ISSUE_DATE9 ,
DRAWN_BANK10 ,
CHEQUE_NUMBER10 ,
CHEQUE_NUMBER10_TO ,
CHEQUE_AMOUNT10 ,
CHEQUE_ISSUE_DAT10 ,
CLEARING_UNIT ,
CLEARING_AGENT ,
BORDEREAU_NUM ,
SPOT_TUN_TRX_UNIT ,
SPOT_TUN_TRX_DATE ,
SPOT_TUN_TRX_USR ,
SPOT_TUN_TRX_SN ,
CONTRACT_REF_NO ,
CONTRACT_DATE ,
NOTIFICATION_DATE ,
MATURITY_DATE ,
ORDER_NUMBER ,
INCOMING_ORDER_NUM ,
OUTGOING_ORDER_NUM ,
PAY_BANK_CODE ,
PAY_BANK_NAME ,
PAY_BRANCH_CODE ,
PAY_BRANCH_ADDRESS ,
PAY_BRANCH_CITY ,
PAY_BRANCH_ZIPCODE ,
BANK_DRAFT_NUM1 ,
BANK_DRAFT_NUM2 ,
BANK_DRAFT_NUM3 ,
BANK_DRAFT_NUM4 ,
BANK_DRAFT_NUM5 ,
BANK_DRAFT_NUM6 ,
BANK_DRAFT_NUM7 ,
BANK_DRAFT_NUM8 ,
BANK_DRAFT_NUM9 ,
BANK_DRAFT_NUM10 ,
INCOMING_DRAFT_NO ,
OUTGOING_DRAFT_NO ,
BOP_CODE ,
SECTOR_CODE ,
COUNTRY_CODE ,
COVERING_MESSAGE ,
SWIFT100 ,
SWIFT103 ,
SWIFT110 ,
SWIFT199 ,
SWIFT202 ,
SWIFT400 ,
SWIFT210 ,
SWIFT300 ,
SWIFT320 ,
RATE_FLAG ,
PRINT_FLAG ,
COLLECTION_FLAG ,
DISPATCH_NUMBER ,
INTERBRANCH_STATUS ,
INTERBRANCH_NUMBER ,
INTERBANK_STATUS ,
INTERBANK_NUMBER ,
DRAFT_ORDER_STATUS ,
FILE_NAME ,
ROW_COUNT ,
HASH_TOTAL ,
TRX_DEBIT_SN ,
TRX_CREDIT_SN ,
SOURCE_CUSTOMER_TY ,
TARGET_CUSTOMER_TY ,
SOURCE_POSITION ,
TARGET_POSITION ,
SOURCE_U_FX_FB_POS ,
TARGET_U_FX_FB_POS ,
SOURCE_U_USER_TOTA ,
TARGET_U_USER_TOTA ,
DIFFERE_U_USER_TOT ,
USER_TOTAL_DOC_IND ,
SOURCE_FWD_CONTRAC ,
TARGET_FWD_CONTRAC ,
COMMENTS ,
TRX_DRAWDOWN_SN ,
TRX_PAYMENT_SN ,
DRAW_TMSTAMP ,
PAY_TMSTAMP ,
CONTINUATION )
AS
    SELECT
    TRX_UNIT,
TRX_DATE ,
TRX_USR ,
TRX_SN ,
TUN_INTERNAL_SN ,
TRX_CODE ,
SOURCE_CURRENCY ,
TARGET_CURRENCY ,
ACC_AMOUNT_1 ,
ACC_AMOUNT_2 ,
ACC_AMOUNT_3 ,
ACC_AMOUNT_4 ,
ACC_AMOUNT_5 ,
ACC_AMOUNT_6 ,
ACC_AMOUNT_7 ,
ACC_AMOUNT_8 ,
ACC_AMOUNT_9 ,
ACC_AMOUNT_10 ,
ACC_AMOUNT_11 ,
ACC_AMOUNT_12 ,
ACC_AMOUNT_13 ,
ACC_AMOUNT_14 ,
ACC_AMOUNT_15 ,
ACC_AMOUNT_16 ,
ACC_AMOUNT_17 ,
ACC_AMOUNT_18 ,
ACC_AMOUNT_19 ,
ACC_AMOUNT_20 ,
ACC_AMOUNT_21 ,
ACC_AMOUNT_22 ,
ACC_AMOUNT_23 ,
ACC_AMOUNT_24 ,
ACC_AMOUNT_25 ,
ACC_AMOUNT_26 ,
ACC_AMOUNT_27 ,
ACC_AMOUNT_28 ,
ACC_AMOUNT_29 ,
ACC_AMOUNT_30 ,
ACC_AMOUNT_31 ,
ACC_AMOUNT_32 ,
ACC_AMOUNT_33 ,
ACC_AMOUNT_34 ,
ACC_AMOUNT_35 ,
ACC_AMOUNT_36 ,
ACC_AMOUNT_37 ,
ACC_AMOUNT_38 ,
ACC_AMOUNT_39 ,
ACC_AMOUNT_40 ,
ACC_AMOUNT_41 ,
ACC_AMOUNT_42 ,
ACC_AMOUNT_43 ,
ACC_AMOUNT_44 ,
ACC_AMOUNT_45 ,
ACC_AMOUNT_46 ,
ACC_AMOUNT_47 ,
ACC_AMOUNT_48 ,
ACC_AMOUNT_49 ,
ACC_AMOUNT_50 ,
GL_ARTICLE_CODE ,
GL_ACCOUNT ,
GL_ACCOUNT_LEVEL ,
GL_NETWORK_ACCOUNT ,
GL_NET_ACC_LEVEL ,
ORG_TRX_UNIT ,
TRX_CUSTOMER_CODE ,
PAYMENT_DRAWN_UNIT ,
COR_GL_ACCOUNT ,
COR_GL_ACCOUNT_LVL ,
EXCH_NOTES_FLAG ,
COR_GL_ACCR_LVL ,
COR_GL_ACCR_ACC ,
ACC_AMOUNT_30_PR ,
ACC_AMOUNT_30_LS ,
ACC_AMOUNT_44_PR ,
ACC_AMOUNT_44_LS ,
ACC_AMOUNT_3_PR ,
ACC_AMOUNT_3_LS ,
ACC_AMOUNT_1_PR ,
ACC_AMOUNT_1_LS ,
TRANSACTION_STATUS ,
SOURCE_BUY_RATE ,
TARGET_SELL_RATE ,
RATE_INDICATOR ,
FX_TYPE ,
I_RATE ,
I_TRX_AMOUNT ,
I_DR_CR_FLAG ,
ACCOUNTED_FLAG ,
PRODUCT_CODE ,
JUSTIFICATION ,
SOURCE_FIXING_RATE ,
TARGET_FIXING_RATE ,
SOURCE_DEP_ACCOUNT ,
TARGET_DEP_ACCOUNT ,
SOURCE_TRN_TYPE ,
TARGET_TRN_TYPE ,
OTHER_SYSTEM ,
PRINT_ID ,
CHANNEL_ID ,
TERMINAL_CODE ,
PRODUCTION_DATE ,
PRODUCTION_TIME ,
AUTHORIZER1 ,
AUTHORIZER2 ,
ORG_TRX_DATE ,
ORG_TRX_USR ,
ORG_TRX_SN ,
CUST_NAME ,
CUST_ADDRESS1 ,
CUST_ADDRESS2 ,
CUST_ZIPCODE ,
CUST_CITY ,
CUST_TAX_REG_NUM ,
CUST_ID_PASSP_NUM ,
CUST_ID_TYPE ,
CUST_ID_ISSUE_AUTH ,
CUST_ID_ISSUE_DATE ,
CUST_COUNTRY ,
BENEF_CUST_CODE ,
BENEF_CUST_NAME ,
BENEF_CUST_ADDRES1 ,
BENEF_CUST_ADDRES2 ,
BENEF_CUST_ZIPCODE ,
BENEF_CUST_CITY ,
BENEF_CUST_ID_TYPE ,
BENEF_CUST_ID_NUM ,
BENEF_TAX_REG_NO ,
BENEF_CUST_ID_ISSU ,
BENEF_CUST_PHONE ,
RATE_TABLE_CATEG ,
SCALE_MAX_AMOUNT ,
OLD_BUY_PERCENT ,
NEW_BUY_PERCENT ,
OLD_SELL_PERCENT ,
NEW_SELL_PERCENT ,
OLD_STATUS ,
NEW_STATUS ,
COM_CHA_TAX_CURR ,
DEALER_CURRENCY_RA ,
RATE_TABLE_NUMBER ,
DEALER_CODE ,
DEALER_REF_NO ,
FX_CATEGORY ,
RESIDENT_IND ,
FX_DOC_NO ,
BALANCE_PAYM_CODE ,
DESTINATION_CNTRY ,
SOURCE_VALUE_DATE ,
TARGET_VALUE_DATE ,
AVAILABILITY_DATE ,
CORRESPONDENT ,
CORRESP_COLLECTION ,
DRAWN_BANK1 ,
CHEQUE_TYPE ,
CHEQUE_NUMBER1 ,
CHEQUE_NUMBER1_TO ,
CHEQUE_AMOUNT1 ,
CHEQUE_ISSUE_DATE1 ,
DRAWN_BANK2 ,
CHEQUE_NUMBER2 ,
CHEQUE_NUMBER2_TO ,
CHEQUE_AMOUNT2 ,
CHEQUE_ISSUE_DATE2 ,
DRAWN_BANK3 ,
CHEQUE_NUMBER3 ,
CHEQUE_NUMBER3_TO ,
CHEQUE_AMOUNT3 ,
CHEQUE_ISSUE_DATE3 ,
DRAWN_BANK4 ,
CHEQUE_NUMBER4 ,
CHEQUE_NUMBER4_TO ,
CHEQUE_AMOUNT4 ,
CHEQUE_ISSUE_DATE4 ,
DRAWN_BANK5 ,
CHEQUE_NUMBER5 ,
CHEQUE_NUMBER5_TO ,
CHEQUE_AMOUNT5 ,
CHEQUE_ISSUE_DATE5 ,
DRAWN_BANK6 ,
CHEQUE_NUMBER6 ,
CHEQUE_NUMBER6_TO ,
CHEQUE_AMOUNT6 ,
CHEQUE_ISSUE_DATE6 ,
DRAWN_BANK7 ,
CHEQUE_NUMBER7 ,
CHEQUE_NUMBER7_TO ,
CHEQUE_AMOUNT7 ,
CHEQUE_ISSUE_DATE7 ,
DRAWN_BANK8 ,
CHEQUE_NUMBER8 ,
CHEQUE_NUMBER8_TO ,
CHEQUE_AMOUNT8 ,
CHEQUE_ISSUE_DATE8 ,
DRAWN_BANK9 ,
CHEQUE_NUMBER9 ,
CHEQUE_NUMBER9_TO ,
CHEQUE_AMOUNT9 ,
CHEQUE_ISSUE_DATE9 ,
DRAWN_BANK10 ,
CHEQUE_NUMBER10 ,
CHEQUE_NUMBER10_TO ,
CHEQUE_AMOUNT10 ,
CHEQUE_ISSUE_DAT10 ,
CLEARING_UNIT ,
CLEARING_AGENT ,
BORDEREAU_NUM ,
SPOT_TUN_TRX_UNIT ,
SPOT_TUN_TRX_DATE ,
SPOT_TUN_TRX_USR ,
SPOT_TUN_TRX_SN ,
CONTRACT_REF_NO ,
CONTRACT_DATE ,
NOTIFICATION_DATE ,
MATURITY_DATE ,
ORDER_NUMBER ,
INCOMING_ORDER_NUM ,
OUTGOING_ORDER_NUM ,
PAY_BANK_CODE ,
PAY_BANK_NAME ,
PAY_BRANCH_CODE ,
PAY_BRANCH_ADDRESS ,
PAY_BRANCH_CITY ,
PAY_BRANCH_ZIPCODE ,
BANK_DRAFT_NUM1 ,
BANK_DRAFT_NUM2 ,
BANK_DRAFT_NUM3 ,
BANK_DRAFT_NUM4 ,
BANK_DRAFT_NUM5 ,
BANK_DRAFT_NUM6 ,
BANK_DRAFT_NUM7 ,
BANK_DRAFT_NUM8 ,
BANK_DRAFT_NUM9 ,
BANK_DRAFT_NUM10 ,
INCOMING_DRAFT_NO ,
OUTGOING_DRAFT_NO ,
BOP_CODE ,
SECTOR_CODE ,
COUNTRY_CODE ,
COVERING_MESSAGE ,
SWIFT100 ,
SWIFT103 ,
SWIFT110 ,
SWIFT199 ,
SWIFT202 ,
SWIFT400 ,
SWIFT210 ,
SWIFT300 ,
SWIFT320 ,
RATE_FLAG ,
PRINT_FLAG ,
COLLECTION_FLAG ,
DISPATCH_NUMBER ,
INTERBRANCH_STATUS ,
INTERBRANCH_NUMBER ,
INTERBANK_STATUS ,
INTERBANK_NUMBER ,
DRAFT_ORDER_STATUS ,
FILE_NAME ,
ROW_COUNT ,
HASH_TOTAL ,
TRX_DEBIT_SN ,
TRX_CREDIT_SN ,
SOURCE_CUSTOMER_TY ,
TARGET_CUSTOMER_TY ,
SOURCE_POSITION ,
TARGET_POSITION ,
SOURCE_U_FX_FB_POS ,
TARGET_U_FX_FB_POS ,
SOURCE_U_USER_TOTA ,
TARGET_U_USER_TOTA ,
DIFFERE_U_USER_TOT ,
USER_TOTAL_DOC_IND ,
SOURCE_FWD_CONTRAC ,
TARGET_FWD_CONTRAC ,
COMMENTS ,
TRX_DRAWDOWN_SN ,
TRX_PAYMENT_SN ,
DRAW_TMSTAMP ,
PAY_TMSTAMP ,
CONTINUATION
    FROM
        FX_FT_RECORDING dtr
    WHERE	dtr.TRX_DATE = (SELECT CURR_TRX_DATE FROM BANK_PARAMETERS bp) AND
			(
				(
					(dtr.SOURCE_CURRENCY != (SELECT ID_CURRENCY FROM CURRENCY WHERE NATIONAL_FLAG = '1' ) OR dtr.TARGET_CURRENCY !=	(SELECT ID_CURRENCY FROM CURRENCY WHERE NATIONAL_FLAG = '1'  ))
				) OR
				(
					(dtr.SOURCE_CURRENCY = (SELECT ID_CURRENCY FROM CURRENCY WHERE NATIONAL_FLAG = '1' ) OR dtr.TARGET_CURRENCY =	(SELECT ID_CURRENCY FROM CURRENCY WHERE NATIONAL_FLAG = '1' )) AND dtr.TRX_CODE >= 12000 AND dtr.TRX_CODE <= 12999 AND (dtr.SOURCE_CURRENCY = 0 OR dtr.TARGET_CURRENCY = 0)
				)
			) AND
			dtr.ACCOUNTED_FLAG = '0' AND
			dtr.GL_ARTICLE_CODE != 0 AND
			dtr.TRX_UNIT >= 0 AND
			(
				(dtr.TRX_CODE > 12501 OR dtr.TRX_CODE < 12501) AND
				(
					(dtr.SOURCE_CURRENCY != (SELECT ID_CURRENCY FROM CURRENCY WHERE NATIONAL_FLAG = '1' ) OR dtr.TARGET_CURRENCY !=	(SELECT ID_CURRENCY FROM CURRENCY WHERE NATIONAL_FLAG = '1' ))
				)
			)
	AND NOT EXISTS (SELECT * FROM FX_OPEN_POS_HDR foph WHERE dtr.TRX_UNIT= foph.TRX_UNIT AND dtr.TRX_DATE= foph.TRX_DATE AND dtr.TRX_USR= foph.TRX_USR AND dtr.TRX_SN= foph.TRX_SN AND dtr.TUN_INTERNAL_SN= foph.TRX_INT_SN );

