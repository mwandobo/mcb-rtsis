CREATE VIEW W_FACT_LOAN_TRX  AS  SELECT loan_trx_recording.trx_date           ,loan_trx_recording.trx_unit           ,loan_trx_recording.trx_usr trx_user           ,loan_trx_recording.trx_sn trx_sn           ,trx_internal_sn tun_internal_sn           ,loan_trx_recording.tmstamp           ,loan_trx_recording.channel_id           ,loan_trx_recording.product_id product_code           ,loan_trx_recording.trx_code           ,loan_trx_recording.i_justification justification_code           ,loan_trx_recording.ut1_id_currency currency_id           ,currency.short_descr currency           ,loan_trx_recording.ut1_cash_db_amn cash_debit_amt           ,loan_trx_recording.ut1_cash_cr_amn cash_credit_amt           ,loan_trx_recording.ut1_journal_db_amn journal_debit_amt           ,loan_trx_recording.ut1_journal_cr_amn journal_credit_amt           ,DECODE (loan_trx_recording.ut1_id_currency                   ,0, 'Non-financial'                   ,'Financial')               financial_flag           ,DECODE (NVL (reversal_flg, '0'), '1', 'Reversal', 'Original')               reversal_flag           ,DECODE (transaction_sts, '1', 'Reversed', 'Posted')               transaction_status_flag           ,DECODE (               NVL (i_tun_unit, 0)              ,0, ' '              ,   TO_CHAR (i_tun_date, 'yyyy-mm-dd')               || '|'               || i_tun_unit               || '|'               || TRIM (i_tun_usr)               || '|'               || i_tun_trn_sn               || '|'               || TO_CHAR (i_tun_tmstamp, 'yyyy-mm-dd HH24.MI.SS'))               reversed_tun           ,acc.account_ser_num acct_key           ,TRIM(acc.account_number) || '-' || acc.account_cd account_no           ,value_date           ,acc_sn           ,acc_type           ,acc_unit           ,justific.description justification_name           ,prft_transaction.description transaction_name           ,commission_amn commission_amt           ,expense_amn expense_amt           ,authorizer1           ,authorizer2         FROM   loan_trx_recording            LEFT JOIN profits_account acc               ON (    lns_sn = loan_trx_recording.acc_sn                   AND lns_type = loan_trx_recording.acc_type                   AND lns_open_unit = loan_trx_recording.acc_unit)            LEFT JOIN currency               ON currency.id_currency = loan_trx_recording.ut1_id_currency            LEFT JOIN justific               ON justific.id_justific = loan_trx_recording.i_justification            LEFT JOIN prft_transaction               ON prft_transaction.id_transact = loan_trx_recording.trx_code         WHERE  trx_internal_sn = 1 AND ut1_id_currency <> 0  WITH NO ROW MOVEMENT;

