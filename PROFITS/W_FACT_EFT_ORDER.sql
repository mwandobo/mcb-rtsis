CREATE VIEW W_FACT_EFT_ORDER  AS  SELECT i.order_code          ,i.trx_date          ,i.trx_code          ,i.justific_id          ,orcur.short_descr order_currency_code          ,DECODE ('IN', 'Incoming', 'OUT', 'Outgoing') order_type          ,pa.cust_id          ,TRIM (cust.first_name) || ' ' || cust.surname customer_name          ,prft_account account_no          ,i.debit_bic_address source_bank_bic          ,a1.sort_code source_bank_sort_code          ,i.credit_bic_address destination_bank          ,a2.sort_code destination_bank_sort_code          ,pacur.short_descr currency_code          ,order_amount order_amount          ,i.settlement_amnt settlement_amount          ,DECODE ('U'                  ,'Unprocessed', '0'                  ,'Canceled', '1'                  ,'Incomplete', '2'                  ,'Finalised', '3'                  ,'Paid', '4'                  ,'Sent', '5'                  ,'Rejected From Us', '6'                  ,'Rejected From Dias/Other Bank', '7'                  ,'Request For Cancelation', '8'                  ,'Processing For File Export')              order_status_ind        FROM   ips_message_header i           LEFT JOIN           (    SELECT f.product                  ,f.participant_bank                  ,f.csm_code                  ,clearing_system                  ,instrum_code                  ,prft_trans_code                  ,ii.instrum_justific                  ,f.sort_code                FROM   frt_swift_address f                   JOIN ips_instrument ii                      ON     TRIM (ii.clearing_system) = TRIM (f.csm_code)                         AND TRIM (ii.instrum_code) = TRIM (f.product)) a1              ON     TRIM (i.debit_bic_address) = TRIM (a1.participant_bank)                 AND TRIM (a1.csm_code) = TRIM (i.clearing_system)                 AND a1.prft_trans_code = i.trx_code                 AND a1.instrum_justific = i.justific_id           LEFT JOIN           (    SELECT f.product                  ,f.participant_bank                  ,f.csm_code                  ,clearing_system                  ,instrum_code                  ,prft_trans_code                  ,ii.instrum_justific                  ,f.sort_code                FROM   frt_swift_address f                   JOIN ips_instrument ii                      ON     TRIM (ii.clearing_system) = TRIM (f.csm_code)                         AND TRIM (ii.instrum_code) = TRIM (f.product)) a2              ON     TRIM (i.credit_bic_address) = TRIM (a1.participant_bank)                 AND TRIM (a2.csm_code) = TRIM (i.clearing_system)                 AND a2.prft_trans_code = i.trx_code                 AND a2.instrum_justific = i.justific_id           LEFT JOIN profits_account pa              ON     TRIM (pa.account_number) = TRIM (i.prft_account)                 AND prft_acc_system = pa.prft_system           LEFT JOIN customer cust ON cust.cust_id = pa.cust_id           LEFT JOIN currency pacur              ON pa.movement_currency = pacur.id_currency           LEFT JOIN currency orcur ON i.order_currency = orcur.id_currency  WITH NO ROW MOVEMENT;

