CREATE VIEW W_FACT_MNT  AS  SELECT mnt_recording.trx_user          ,mnt_recording.trx_unit          ,mnt_recording.trx_date          ,trx_usr_sn trx_sn          ,grp_subscript          ,mnt_recording.tmstamp          ,mnt_recording.id_product product_code          ,mnt_recording.trx_code          ,mnt_recording.id_justific justification_code          ,mnt_recording.acc_id_currency currency_id          ,currency.short_descr currency          ,CASE mnt_recording.id_justific              WHEN 1193 THEN mnt_recording.acc_amount_57              ELSE mnt_recording.acc_amount_60               END              journal_debit_amt          ,CASE mnt_recording.id_justific              WHEN 1193 THEN mnt_recording.acc_amount_57              ELSE mnt_recording.acc_amount_60               END              journal_credit_amt          ,mnt_recording.channel_id          ,CASE              WHEN     mnt_recording.trx_code = 1693                   AND mnt_recording.acc_id_currency <> 0                   AND (   mnt_recording.acc_amount_60 <> 0                        OR mnt_recording.acc_amount_57 <> 0)              THEN                 'Financial'              ELSE                 'Non-financial'               END              financial_flag          ,DECODE (NVL (reversal_flag, '0'), '1', 'Reversal', 'Original')              reversal_flag          ,justific.description justification_name          ,prft_transaction.description transaction_name          ,unit.unit_name trx_unit_name          ,mnt_recording.trx_details comments          ,mnt_recording.authorizer1          ,mnt_recording.authorizer2          ,CASE              WHEN     mnt_recording.prft_system = 4                   AND mnt_recording.trx_user = '99974431'              THEN                 'Loan Payment'              WHEN     mnt_recording.trx_code = 1693                   AND mnt_recording.acc_id_currency <> 0                   AND (   mnt_recording.acc_amount_60 <> 0                        OR mnt_recording.acc_amount_57 <> 0)              THEN                 'Customer Transfer'              ELSE                 'Other'               END              type_ind          ,mnt_recording.account_number          ,mnt_recording.prft_system          ,mnt_recording.acc_unit acct_monitoring_unit          ,la.account_ser_num acct_key        FROM   mnt_recording           LEFT JOIN unit ON mnt_recording.trx_unit = unit.code           LEFT JOIN currency              ON currency.id_currency = mnt_recording.acc_id_currency           LEFT JOIN justific              ON justific.id_justific = mnt_recording.id_justific           LEFT JOIN prft_transaction              ON prft_transaction.id_transact = mnt_recording.trx_code           LEFT JOIN profits_account la              ON     la.lns_open_unit = mnt_recording.lns_acc_unit                 AND la.lns_type = mnt_recording.lns_acc_type                 AND la.lns_sn = mnt_recording.lns_acc_sn                 AND mnt_recording.prft_system = la.prft_system                 AND mnt_recording.grp_subscript = 1  WITH NO ROW MOVEMENT;

