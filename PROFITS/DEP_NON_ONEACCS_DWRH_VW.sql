CREATE VIEW DEP_NON_ONEACCS_DWRH_VW  (     EOM_DATE,     ACCOUNT_NUMBER,     ID_PRODUCT,     BOOK_BALANCE,     BOOK_BALANCE_LC,     ID_CURRENCY,     REMAINING_DAYS,     RATE,     DEPOSIT_TYPE,     ENTRY_STATUS,     DEP_ACC_NUMBER,     "fixing_rate",     ONE_ACCOUNT_FLG,     TYPE_CURRENT_ACCOUNT,     FKGH_CATEGORY,     FKGD_CATEGORY,     START_DATE,     FK0UNITCODE,     CHECKING_ACC_TYPE,     CUST_TYPE,     CUST_ID,     LNS_ACC_TYPE,     LNS_UNITCODE,     LNS_ACC_SN,     EXPIRY_DATE,     ACCOUNT_LIMIT,     ACCR_CR_INTER_LC,     ACCR_DB_INTER_LC,     ACCR_EXCESS_INT_LC,     CR_PROGRESS_INT_LC,     DB_PROGRESS_INT_LC,     ACCR_EXC_PROGRE_LC  )  AS     SELECT /******************************************************************************
              NAME:   dep_non_oneaccs_dwrh_vw
              PURPOSE: This is a view used mainly for the Deposits Accounts of Pankreta Bank.
                   Excludes the 1. Pankretan Accounts with negative balance as well as ...
                      2. Current Accounts with negative balance
               REVISIONS:
               Ver    Date    Author     Description
              ---------  ----------  ---------------   ------------------------------------
              1.0  10/12/2012     1. Created this function.
               1.0    17/12/2012    Added new field start_date.
               1.0    17/01/2013    Added new field fk0unitcode.
              1.0    12/02/2013     Added time deposits that are inactive and expire the next working date.
               NOTES:
                Object Name:  dep_non_oneaccs_dwrh_vw
              Sysdate:     10/12/2012
               Date and Time: 10/12/2012, 14:38:30, and 10/12/2012 14:38:30
                Username:     LIAKOD
               Table Name:   eom_deposits
               ******************************************************************************/           eom_date,            d.account_number,            NVL (d.id_product, 0) id_product,            NVL (d.book_balance, 0) book_balance,            NVL (d.book_balance * fixing_rate, 0) book_balance_lc,            NVL (d.id_currency, 0) id_currency,            NVL (d.remaining_days, 0) remaining_days,            NVL (d.rate, 0) rate,            NVL (d.deposit_type, 0) deposit_type,            NVL (d.entry_status, 0) entry_status,            NVL (d.dep_acc_number, 0) dep_acc_number,            NVL (fixing_rate, 0) "fixing_rate",            NVL (one_account_flg, 0) one_account_flg,            NVL (               (SELECT 1                  FROM deposit                 WHERE     deposit.fk_generic_detafk = 'LACTP'                       AND deposit.fk_generic_detaser IN (50, 31)                       AND d.id_product = deposit.fk_productid_produ),               0)               type_current_account,            NVL (fkgh_category, 0) fkgh_category,            NVL (fkgd_category, 0) fkgd_category,            NVL (start_date, TO_DATE ('01/01/1900', 'dd/mm/yyyy')) start_date,            NVL (fk0unitcode, 0) fk0unitcode,            NVL (checking_acc_type, 0) checking_acc_type,            NVL (cust_type, 0) cust_type,            cust_id,            NVL (lns_acc_type, 0) lns_acc_type,            NVL (lns_unitcode, 0) lns_unitcode,            NVL (lns_acc_sn, 0) lns_acc_sn,            NVL (expiry_date, TO_DATE ('01/01/1900', 'dd/mm/yyyy')) expiry_date,            NVL (d.account_limit, 0) account_limit,            NVL (accr_cr_inter_lc, 0) accr_cr_inter_lc,            NVL (accr_db_inter_lc, 0) accr_db_inter_lc,            NVL (accr_excess_int_lc, 0) accr_excess_int_lc,            NVL (cr_progress_int_lc, 0) cr_progress_int_lc,            NVL (db_progress_int_lc, 0) db_progress_int_lc,            NVL (accr_exc_progre_lc, 0) accr_exc_progre_lc       FROM eom_deposits d      WHERE     (   d.entry_status NOT IN ('0', '3', '4')                 OR EXISTS                       (SELECT 'x'                          FROM calendar_bns_days_vw                         WHERE     date_id = d.eom_date                               AND date_id_b = expiry_date                               AND wd_sn_b - wd_sn = 1                               AND d.entry_status = '3'))            AND (   book_balance >= 0                 OR (    book_balance < 0                     AND NOT EXISTS                                (SELECT 'x'                                   FROM deposit                                  WHERE     deposit.fk_generic_detafk = 'LACTP'                                        AND deposit.fk_generic_detaser IN (50,                                                                           31)                                        AND d.id_product =                                               deposit.fk_productid_produ                                        AND d.book_balance < 0)                     AND NVL (one_account_flg, 0) <> '1'));

