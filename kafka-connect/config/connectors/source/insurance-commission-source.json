{
  "name": "db2-insurance-commission-source",
  "config": {
    "connector.class": "io.confluent.connect.jdbc.JdbcSourceConnector",
    "tasks.max": "1",
    
    "connection.url": "jdbc:db2://${DB2_HOST}:${DB2_PORT}/${DB2_DATABASE}",
    "connection.user": "${DB2_USER}",
    "connection.password": "${DB2_PASSWORD}",
    
    "mode": "timestamp",
    "timestamp.column.name": "commissionReceivedDate",
    "poll.interval.ms": "5000",
    "batch.max.rows": "1000",
    
    "query": "SELECT (SELECT CURRENT TIMESTAMP FROM SYSIBM.SYSDUMMY1) AS reportingDate, '' AS policyNumber, gte.CURRENCY_SHORT_DES AS currency, DECIMAL(gte.DC_AMOUNT, 15, 2) AS orgCommissionReceivedAmount, CASE WHEN UPPER(gte.CURRENCY_SHORT_DES) = 'USD' THEN DECIMAL(gte.DC_AMOUNT, 15, 2) * 2730.50 ELSE DECIMAL(gte.DC_AMOUNT, 15, 2) END AS tzsCommissionReceivedAmount, gte.TRN_DATE AS commissionReceivedDate FROM GLI_TRX_EXTRACT gte JOIN GLG_ACCOUNT AS gl ON gl.ACCOUNT_ID = gte.FK_GLG_ACCOUNTACCO WHERE gl.EXTERNAL_GLACCOUNT IN ('503010011', '503010012')",
    
    "topic.prefix": "bank.db2.",
    "table.types": "VIEW",
    
    "transforms": "createKey,setSchema",
    "transforms.createKey.type": "org.apache.kafka.connect.transforms.ValueToKey",
    "transforms.createKey.fields": "commissionReceivedDate,currency",
    "transforms.setSchema.type": "org.apache.kafka.connect.transforms.SetSchemaMetadata$Value",
    "transforms.setSchema.schema.name": "bank.insurance_commission",
    
    "errors.tolerance": "none",
    "errors.log.enable": "true",
    "errors.log.include.messages": "true"
  }
}
