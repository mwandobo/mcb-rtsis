{
  "name": "db2-balance-with-other-bank-source",
  "config": {
    "connector.class": "io.confluent.connect.jdbc.JdbcSourceConnector",
    "tasks.max": "1",
    
    "connection.url": "jdbc:db2://${DB2_HOST}:${DB2_PORT}/${DB2_DATABASE}",
    "connection.user": "${DB2_USER}",
    "connection.password": "${DB2_PASSWORD}",
    
    "mode": "timestamp",
    "timestamp.column.name": "transactionDate",
    "poll.interval.ms": "3000",
    "batch.max.rows": "1000",
    
    "query": "SELECT CURRENT_TIMESTAMP AS reportingDate, gte.FK_GLG_ACCOUNTACCO as accountNumber, c.FIRST_NAME as accountName, CASE WHEN UPPER(c.FIRST_NAME) = 'ECOBANK' THEN 'ECOCTZTZXXX' WHEN UPPER(c.FIRST_NAME) = 'BOA' THEN 'EUAFTZTZXXX' WHEN UPPER(c.FIRST_NAME) = 'TPB' THEN 'TAPBTZTZ' WHEN UPPER(c.FIRST_NAME) = 'TANZANIA POSTAL BANK' THEN 'TAPBTZTZXX' ELSE VARCHAR(gte.FK0UNITCODE) END AS bankCode, 'Tanzania' as Country, 'Domestic bank related' as relationshipType, '' as accountType, '' as subAccountType, gte.CURRENCY_SHORT_DES as currency, gte.DC_AMOUNT AS orgAmount, CASE WHEN gte.CURRENCY_SHORT_DES = 'USD' THEN gte.DC_AMOUNT ELSE NULL END AS usdAmount, CASE WHEN gte.CURRENCY_SHORT_DES = 'USD' THEN gte.DC_AMOUNT * 2500 ELSE gte.DC_AMOUNT END AS tzsAmount, gte.TRN_DATE as transactionDate, (DATE(gte.AVAILABILITY_DATE) - DATE(gte.TRN_DATE)) AS pastDueDays, 0 as allowanceProbableLoss, 0 as botProvision, 'Current' as assetsClassificationCategory, gte.TRN_DATE as contractDate, gte.AVAILABILITY_DATE as maturityDate, 'Highly rated Multilateral Development Banks' as externalRatingCorrespondentBank, '' as gradesUnratedBanks FROM GLI_TRX_EXTRACT as gte JOIN GLG_ACCOUNT gl ON gte.FK_GLG_ACCOUNTACCO = gl.ACCOUNT_ID JOIN CUSTOMER c ON gte.CUST_ID = c.CUST_ID WHERE gl.EXTERNAL_GLACCOUNT IN('100050001')",
    
    "topic.prefix": "bank.db2.",
    "table.types": "VIEW",
    
    "transforms": "createKey,setSchema",
    "transforms.createKey.type": "org.apache.kafka.connect.transforms.ValueToKey",
    "transforms.createKey.fields": "accountNumber,transactionDate",
    "transforms.setSchema.type": "org.apache.kafka.connect.transforms.SetSchemaMetadata$Value",
    "transforms.setSchema.schema.name": "bank.balance_with_other_bank",
    
    "errors.tolerance": "none",
    "errors.log.enable": "true",
    "errors.log.include.messages": "true"
  }
}
