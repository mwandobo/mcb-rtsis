{
  "name": "db2-loan-transaction-source",
  "config": {
    "connector.class": "io.confluent.connect.jdbc.JdbcSourceConnector",
    "tasks.max": "1",
    
    "connection.url": "jdbc:db2://${DB2_HOST}:${DB2_PORT}/${DB2_DATABASE}",
    "connection.user": "${DB2_USER}",
    "connection.password": "${DB2_PASSWORD}",
    
    "mode": "timestamp",
    "timestamp.column.name": "transactionDate",
    "poll.interval.ms": "2000",
    "batch.max.rows": "1000",
    
    "query": "SELECT CURRENT_TIMESTAMP AS reportingDate, W.AGREEMENT_NUMBER AS loanNumber, gte.TRN_DATE AS transactionDate, '' AS loanTransactionType, NULL AS loanTransactionSubType, gte.CURRENCY_SHORT_DES AS currency, gte.DC_AMOUNT AS orgTransactionAmount, CASE WHEN gte.CURRENCY_SHORT_DES = 'USD' THEN gte.DC_AMOUNT ELSE NULL END AS usdTransactionAmount, CASE WHEN gte.CURRENCY_SHORT_DES = 'USD' THEN gte.DC_AMOUNT * 2500.00 ELSE gte.DC_AMOUNT END AS tzsTransactionAmount FROM GLI_TRX_EXTRACT AS gte LEFT JOIN W_EOM_LOAN_ACCOUNT AS W ON W.CUST_ID = gte.CUST_ID LEFT JOIN GLG_ACCOUNT AS gl ON gl.ACCOUNT_ID = gte.FK_GLG_ACCOUNTACCO WHERE gl.EXTERNAL_GLACCOUNT IN ('110000001', '110000005', '110010001', '110010012', '110020001', '110020002', '110020003', '110020005', '110020007', '110020008', '110020009', '110020011', '110030001', '110030002', '110030003', '110030004', '120000001', '120000005', '120010001', '120020001', '120020002', '120010012', '120030002', '120050001', '120030003', '120030006', '120050005', '120020007', '130000005')",
    
    "topic.prefix": "bank.db2.",
    "table.types": "VIEW",
    
    "transforms": "createKey,setSchema",
    "transforms.createKey.type": "org.apache.kafka.connect.transforms.ValueToKey",
    "transforms.createKey.fields": "loanNumber,transactionDate",
    "transforms.setSchema.type": "org.apache.kafka.connect.transforms.SetSchemaMetadata$Value",
    "transforms.setSchema.schema.name": "bank.loan_transaction",
    
    "errors.tolerance": "none",
    "errors.log.enable": "true",
    "errors.log.include.messages": "true"
  }
}
